<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows-style Interface</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #151515;
            font-family: Arial, sans-serif;
            overflow: hidden;
            /* Hide scrollbar of body */
        }

        .window {
            position: absolute;
            background-color: #f9ffdc;
            border: 1px solid #ccc;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            z-index: 100;
        }

        .sidebar {
            width: 300px;
            height: 90vh;
            top: 0;
            left: 0;
            overflow-y: auto;
            padding: 10px;
            resize: both;
        }

        .camera-list-item {
            word-wrap: break-word;
            max-width: 100%;
            margin-bottom: 5px;
            padding: 5px;
            background-color: #a5ff93;
            /* Button background color */
            border: 1px solid #ccc;
            /* Button border */
            border-radius: 5px;
            /* Rounded corners */
            cursor: pointer;
            /* Cursor on hover */
            transition: background-color 0.3s ease;
            /* Smooth transition on hover */
        }

        .camera-list-item:hover {
            background-color: #e1e174;
            /* Button background color on hover */
        }

        .video-container {
            resize: vertical;
            overflow: hidden;
            /* Disable scrolling */
        }

        .window-titlebar {
            background-color: #c3c3c3;
            padding: 5px;
            cursor: move;
            display: flex;
            justify-content: space-between;
        }

        .close-button {
            background-color: transparent;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 14px;
        }

        .close-button:hover {
            color: #333;
        }

        .ip-info {
            padding: 10px;
            background-color: #e6dbbf;
            border-top: 1px solid #8c8c8c;
            font-size: 12px;
        }

        #addIpInput {
            width: 200px;
            margin-bottom: 10px;
        }

        #addIpButton {
            padding: 5px 10px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        #addIpButton:hover {
            background-color: #0056b3;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="window sidebar" id="sidebar">
            <div class="window-titlebar">Online IP Cameras</div>
            <div class="window-content">
                <form id="addIpForm">
                    <input type="text" id="addIpInput" placeholder="Enter IP address">
                    <button type="submit" id="addIpButton">Add IP</button>
                </form>
                <ul class="camera-list" id="cameraList">
                    <!-- Online RTSP IP addresses will be inserted here dynamically -->
                </ul>
            </div>
        </div>
    </div>

    <script>
        // JavaScript code to fetch and display online RTSP IP addresses
        fetch('rtsp_url.txt') // Assuming rtsp_url.txt is in the same directory as your HTML file
            .then(response => response.text()) // Read the text file
            .then(data => {
                const rtspUrls = data.split('\n').map(url => url.trim()); // Split by newline and remove whitespace
                const cameraList = document.getElementById('cameraList');
                rtspUrls.forEach(url => {
                    const listItem = document.createElement('li');
                    listItem.textContent = url;
                    listItem.className = 'camera-list-item';
                    listItem.addEventListener('click', () => {
                        openVideoWindow(url);
                    });
                    cameraList.appendChild(listItem);
                });
            })
            .catch(error => console.error('Error fetching online cameras:', error));


        // Function to open a new video container window with the selected RTSP stream
        function openVideoWindow(rtspUrl) {
            // Create a new video container window
            const newWindow = document.createElement('div');
            newWindow.className = 'window video-container';
            newWindow.innerHTML = `
            <div class="window-titlebar">
                    <span id="videoTitle">${rtspUrl}</span>
                    <button class="close-button" onclick="closeVideoWindow()">Close</button>
                </div>
                <div class="window-content">
                    <iframe id="rtspFrame" class="video-player" frameborder="0" allowfullscreen="1" src="https://streamedian.com/embed?s=${btoa(rtspUrl)}&r=MTI4MHg3MjA=" width="800" height="450"></iframe>
                    <div class="ip-info" id="ipInfo">Fetching IP information...</div>
                    <div class="google-maps" id="googleMaps"></div>
                </div>
            `;
            document.body.appendChild(newWindow);
            // Make the new window draggable
            makeDraggable(newWindow);
            // Fetch IP information
            fetchIPInfo(rtspUrl);
        }

        // Function to close a video container window
        function closeVideoWindow() {
            const videoContainer = document.querySelector('.video-container');
            videoContainer.remove();
        }

        // Function to make a window draggable
        function makeDraggable(windowElement) {
            let pos1 = 0,
                pos2 = 0,
                pos3 = 0,
                pos4 = 0;
            const titlebar = windowElement.querySelector('.window-titlebar');
            titlebar.onmousedown = dragMouseDown;

            function dragMouseDown(e) {
                e = e || window.event;
                e.preventDefault();
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
            }

            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                windowElement.style.top = (windowElement.offsetTop - pos2) + "px";
                windowElement.style.left = (windowElement.offsetLeft - pos1) + "px";
            }

            function closeDragElement() {
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }

        // Function to fetch and display IP information
        function fetchIPInfo(rtspUrl) {
            // Extract IP address from RTSP URL
            const ip = rtspUrl.match(/(\d+\.\d+\.\d+\.\d+)/)[0];
            fetch(`https://lazy-gold-millipede-kilt.cyclic.app/api/ip-info/${ip}`) // fetch(`/api/ip-info/${ip}`) // fetch(`https://jxint-server-api.fly.dev/api/ip-info/${ip}`)
                .then(response => response.json())
                .then(data => {
                    const ipInfo = document.getElementById('ipInfo');
                    ipInfo.innerHTML = `
                        <p><strong>Status:</strong> ${data.status}</p>
                        <p><strong>Message:</strong> ${data.message}</p>
                        <p><strong>Continent:</strong> ${data.continent}</p>
                        <p><strong>Continent Code:</strong> ${data.continentCode}</p>
                        <p><strong>Country:</strong> ${data.country} (${data.countryCode})</p>
                        <p><strong>Region:</strong> ${data.regionName} (${data.region})</p>
                        <p><strong>City:</strong> ${data.city}</p>
                        <p><strong>District:</strong> ${data.district}</p>
                        <p><strong>ZIP Code:</strong> ${data.zip}</p>
                        <p><strong>Latitude:</strong> ${data.lat}</p>
                        <p><strong>Longitude:</strong> ${data.lon}</p>
                        <p><strong>Timezone:</strong> ${data.timezone}</p>
                        <p><strong>Offset:</strong> ${data.offset}</p>
                        <p><strong>Currency:</strong> ${data.currency}</p>
                        <p><strong>ISP:</strong> ${data.isp}</p>
                        <p><strong>Organization:</strong> ${data.org}</p>
                        <p><strong>ASN:</strong> ${data.as}</p>
                        <p><strong>ASN Name:</strong> ${data.asname}</p>
                        <p><strong>Reverse DNS:</strong> ${data.reverse}</p>
                        <p><strong>Mobile:</strong> ${data.mobile}</p>
                        <p><strong>Proxy:</strong> ${data.proxy}</p>
                        <p><strong>Hosting:</strong> ${data.hosting}</p>
                        <p><strong>Query:</strong> ${data.query}</p>
                    `;

                    // Add Google Maps iframe
                    const googleMaps = document.getElementById('googleMaps');
                    googleMaps.innerHTML = `
                        <iframe width="100%" height="100%" frameborder="0" style="border:0" src="https://maps.google.com/maps?width=100%&amp;height=600&amp;hl=en&amp;coord=${data.lat},${data.lon}&amp;q=1%20${data.district}%20Street%2C%20${data.city}%2C%20${data.regionName}&amp;ie=UTF8&amp;t=&amp;z=14&amp;iwloc=B&amp;output=embed" allowfullscreen></iframe>
                    `;
                })
                .catch(error => {
                    console.error('Error fetching IP information:', error);
                    const ipInfo = document.getElementById('ipInfo');
                    ipInfo.textContent = 'Error fetching IP information';
                });
        }

        // Function to add a new IP address
        const addIpButton = document.getElementById('addIpButton');
        addIpButton.addEventListener('click', () => {
            const addIpInput = document.getElementById('addIpInput');
            const newIp = addIpInput.value.trim();
            if (newIp) {
                const cameraList = document.getElementById('cameraList');
                const listItem = document.createElement('li');
                listItem.textContent = newIp;
                listItem.className = 'camera-list-item';
                listItem.addEventListener('click', () => {
                    openVideoWindow(newIp);
                });
                cameraList.appendChild(listItem);
                addIpInput.value = '';
            }
        });
        // Function to update the camera list with new IP addresses
        function updateCameraList(ipList) {
            const cameraList = document.getElementById('cameraList');
            cameraList.innerHTML = ''; // Clear previous list
            ipList.forEach(ip => {
                const listItem = document.createElement('li');
                listItem.textContent = ip;
                listItem.className = 'camera-list-item';
                listItem.addEventListener('click', () => {
                    openVideoWindow(ip);
                });
                cameraList.appendChild(listItem);
            });
        }

        // Function to add a new IP address to the list
        document.getElementById('addIpForm').addEventListener('submit', function (event) {
            event.preventDefault(); // Prevent form submission
            const addIpInput = document.getElementById('addIpInput');
            const newIp = addIpInput.value.trim();
            if (newIp) {
                // Add new IP address to the list
                fetch('/add-ip', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'text/plain'
                        },
                        body: newIp
                    })
                    .then(response => {
                        if (response.ok) {
                            return response.text();
                        } else {
                            throw new Error('Failed to add IP address');
                        }
                    })
                    .then(() => {
                        // Update UI with the new IP address
                        updateCameraList([...document.querySelectorAll('.camera-list-item')].map(item =>
                            item.textContent).concat(newIp));
                        addIpInput.value = ''; // Clear input field
                    })
                    .catch(error => {
                        console.error('Error adding IP address:', error);
                        // Handle error
                    });
            }
        });
    </script>
</body>

</html>
